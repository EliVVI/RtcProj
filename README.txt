Сессии пользователей хранятся в глобальном объекте __clientsSessions.

Ключи объекта - значение куки NODESESSID.

Далее там сохраняется текущий id сокета (так как постоянно меняется при перезагрузке страницы), который генерируется СЕРВЕРОМ __clientsSessions[currentRequest["NODESESSID"]]["curentnodeid"] = clientCurrentNodeId;

А также GUID, впринципе нахрен не нужен (так как постоянно меняется при перезагрузке страницы), который также генерируется СЕРВЕРОМ __clientsSessions[currentRequest["NODESESSID"]]["curentguid"] = clientCurrentGuid;

Страница клиента создаёт объект RTCPeerConnection и выполняет его метод CreateOffer.

При создании оффера клиент генерирует событие saveRtcInfo, которое и отслеживает сервер.

В массив __clientsSessions для данной сессии сохраняются параметры оффера __clientsSessions[currentRequest["NODESESSID"]]["sdp"]

На страницу клиента выводится список пользователей, с которым он может установить канал обмена данными.

Выбор пользователя ведет к установке LocalDescription, а также генерирует событие userToConnect.

Отслеживание обмена ice-кандидатами занимается на стороне сервера обработчика на событие ice (генерируется на клиенте внутри ф-ции peerConnection.onicecandidate).

Он же делает широковщательный ответ takeIce. Обрабатываемый на клиенте.

В колбэк обработчика передаётся текущий id клиета, который хочет установить связь (его оффер передаётся), и в id клиента, к которому он хочет подсоединиться.

Делается ширововещательная рассылка с событием wantToConnect - io.sockets.emit("wantToConnect", JSON.stringify({clientid : params.remoteId, param : paramsSdp, from : params.me}));

На клиенте есть отслеживание на это событие. Устанавливется RemoteDEscription открывается канал ответа. Также посылается ответ.

Ответ отправляется через функцию demandAnswer, где сокетом генерируется событие remoteAnswer.

На стороне сервера обработчик на это событие в свою очередь рассылает сообщение takeAnswer всем клинтам.

Так как оно содержит идентификатор инициатора общения, то именно инициатор его улавливает, устанавливает RemoteDescription.

С этого мемента канал открыт.